# Cross configuration for mise
# Use :main images based on Ubuntu 20.04 (glibc 2.31)
# This is the minimum needed for C++17 std library support required by luau0-src/mlua

[build.env]
passthrough = [
  "RUST_BACKTRACE",
  "CARGO_TERM_COLOR",
  "AWS_LC_SYS_EXTERNAL_BINDGEN",
  "BINDGEN_EXTRA_CLANG_ARGS",
]

[target.x86_64-unknown-linux-gnu]
image = "ghcr.io/cross-rs/x86_64-unknown-linux-gnu:main"

[target.aarch64-unknown-linux-gnu]
image = "ghcr.io/cross-rs/aarch64-unknown-linux-gnu:main"
pre-build = [
  "apt-get update && apt-get install --assume-yes --no-install-recommends libclang-dev clang curl",
  "curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y --default-toolchain stable",
  ". ~/.cargo/env && cargo install --force --locked bindgen-cli",
  "ln -s ~/.cargo/bin/bindgen /usr/local/bin/bindgen",
]

[target.armv7-unknown-linux-gnueabi]
image = "ghcr.io/cross-rs/armv7-unknown-linux-gnueabi:main"
pre-build = [
  "dpkg --add-architecture armhf",
  "apt-get update && apt-get install -y libclang-dev clang llvm-dev pkg-config",
]


# Musl targets for static linking
[target.x86_64-unknown-linux-musl]
image = "ghcr.io/cross-rs/x86_64-unknown-linux-musl:main"

[target.aarch64-unknown-linux-musl]
image = "ghcr.io/cross-rs/aarch64-unknown-linux-musl:main"

[target.armv7-unknown-linux-musleabi]
image = "ghcr.io/cross-rs/armv7-unknown-linux-musleabi:main"
