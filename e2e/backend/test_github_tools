#!/usr/bin/env bash

assert "mise use github:BurntSushi/ripgrep@14.1.0"
assert "mise which rg"
assert_contains "mise x -- rg --version" "ripgrep 14.1.0"

# zip file with strip_components=1
assert "mise use github:nats-io/natscli@0.2.3"
assert "mise which nats"
assert_contains "mise x -- nats --version" "0.2.3"

# Test GitHub backend with mise lock
export MISE_LOCKFILE=1
export MISE_EXPERIMENTAL=1

cat <<EOF >mise.toml
[tools]
"github:BurntSushi/ripgrep" = "14.1.0"
EOF

touch mise.lock
mise install
mise lock --force --platforms macos-arm64
assert_contains "cat mise.lock" '[[tools."github:BurntSushi/ripgrep"]]'
assert_contains "cat mise.lock" 'version = "14.1.0"'
assert_contains "cat mise.lock" 'backend = "github:BurntSushi/ripgrep"'
assert_contains "cat mise.lock" 'url = "https://github.com/BurntSushi/ripgrep/releases'
assert_contains "cat mise.lock" 'platforms.macos-arm64'
