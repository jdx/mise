#!/usr/bin/env bash
# Test global task_inherit_parent setting

# Create parent directory with tasks
mkdir -p parent/child

cat <<EOF >parent/mise.toml
[tasks.parent-task]
run = "echo parent"
EOF

cat <<EOF >parent/child/mise.toml
[tasks.child-task]
run = "echo child"
EOF

# In child directory, parent-task should be visible by default
cd parent/child
assert_contains "mise tasks" "parent-task"
assert_contains "mise tasks" "child-task"

# With task_inherit_parent=false, only child-task should be visible
export MISE_TASK_INHERIT_PARENT=false
if mise tasks 2>&1 | grep -q "parent-task"; then
	fail "parent-task should not be visible when task_inherit_parent=false"
else
	ok "parent-task correctly hidden when task_inherit_parent=false"
fi
assert_contains "mise tasks" "child-task"
unset MISE_TASK_INHERIT_PARENT

# Test via config file setting
cat <<EOF >mise.toml
[settings]
task_inherit_parent = false

[tasks.child-task]
run = "echo child"
EOF

if mise tasks 2>&1 | grep -q "parent-task"; then
	fail "parent-task should not be visible with task_inherit_parent=false in config"
else
	ok "parent-task correctly hidden with task_inherit_parent=false in config"
fi
assert_contains "mise tasks" "child-task"
